<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/html">
<head th:replace="common/head :: head"></head>
<link type="text/css" th:href="@{/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.css}" rel="stylesheet">
<script type="text/javascript" th:src="@{/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js}"></script>
<style>
    .onoffswitch-inner:before {
        content: "";
    }

    .onoffswitch-inner:after {
        content: "";
    }

    #permissions {
        margin-left: -38px;
    }

    .form-control.hasDatepicker {
        background-color: #FFFFFF;
        color: black;
    }
</style>

<body class="fix-header card-no-border">
<div th:insert="common/templates::alertMessage"></div>
<div th:insert="common/templates::pagination"></div>
<div th:insert="common/templates::contextPath"></div>
<!-- Preloader - style you can find in spinners.css -->
<div class="preloader">
    <svg class="circular" viewBox="25 25 50 50">
        <circle class="path" cx="50" cy="50" fill="none" r="20" stroke-miterlimit="10" stroke-width="2"/>
    </svg>
</div>

<!-- Main wrapper - style you can find in pages.scss -->
<div id="main-wrapper">
    <div th:replace="common/bodyHeader"></div>

    <!-- Left Sidebar - style you can find in sidebar.scss  -->
    <div th:replace="common/leftmenu"></div>
    <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid">

            <div class="row pd-r-ctn">
                <div class="col-12">
                    <!--Data table -->
                    <form id="campaignMangerForm" class="form" method="get">
                        <div class="card">

                            <div class="card-block">
                                <div class="row smal_title">
                                    <h4 class="card-title col-lg-6"><i class="campaign_ic"></i>Chiến dịch</h4>
                                    <div class="title_btn col-1g-6">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-rounded btn-primary dropdown-toggle"
                                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i
                                                    class="ti-plus text" aria-hidden="true"></i>Tạo mới chiến dịch
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" th:href="@{/frequency-campaign/create}">Chiến
                                                    dịch tần suất</a>
                                                <a class="dropdown-item" th:href="@{/event-campaign/create}">Chiến dịch
                                                    sự kiện</a>
                                            </div>
                                        </div>
                                        <div class="btn-group">
                                            <button type="button"
                                                    class="btn btn-rounded btn-outline-primary"
                                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                    onclick="exportCampaign();"
                                                    th:if="${roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || roleLogin == 'Kinh doanh'} "
                                            >
                                                <i class="icon-share-alt"></i> Xuất danh sách
                                            </button>

                                        </div>
                                    </div>
                                </div>

                                <div class="table-responsive m-t-10">

                                    <div class="row search_table search_campaign">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Tên chiến dịch</label>
                                                        <input type="text" id="campaignName" name="campaignName"
                                                               class="form-control"
                                                               placeholder="Tìm kiếm tên chiến dịch"
                                                               th:value="${campaignName}" maxlength="100">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Loại chiến dịch</label>
                                                        <select class="form-control custom-select"
                                                                data-placeholder="Tất cả"
                                                                tabindex="1" id="type" name="type">
                                                            <option th:selected="(${type} == 0)" value="0">Tất cả
                                                            </option>
                                                            <option th:selected="(${type} == 1)" value="1">Sự kiện
                                                            </option>
                                                            <option th:selected="(${type} == 2)" value="2">Tần suất
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Người tạo</label>
                                                        <input class="form-control" type="text"
                                                               placeholder="Tìm kiếm người tạo chiến dịch"
                                                               id="createdUser" name="createdUser"
                                                               th:value="${createdUser}" maxlength="100">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row m-t-20">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Ngày bắt đầu từ</label>
                                                        <input class="form-control date-picker" type="text"
                                                               id="startDate" name="startDate" th:value="${startDate}"
                                                               placeholder="dd/mm/yyyy">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Ngày kết thúc đến</label>
                                                        <input class="form-control date-picker" type="text"
                                                               id="endDate" name="endDate" th:value="${endDate}"
                                                               placeholder="dd/mm/yyyy">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Ngày tạo chiến dịch</label>
                                                        <input class="form-control date-picker" type="text"
                                                               id="createdDate" name="createdDate"
                                                               th:value="${createdDate}" placeholder="dd/mm/yyyy">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row m-t-20">
                                                <div class="col-md-10">
                                                    <div class="row_stt">
                                                        <label class="control-label">Trạng thái</label>
                                                        <div class="form-check">
                                                            <ul class="icheck-list">
                                                                <li>
                                                                    <input type="checkbox" class="check checked"
                                                                           id="statusInit" name="statusInit"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusInit !=null}">
                                                                    <label>Đang xử lý</label>
                                                                </li>
                                                                <li>
                                                                    <input type="checkbox" class="check"
                                                                           id="statusApprove" name="statusApprove"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusApprove !=null}">
                                                                    <label>Chờ phê duyệt</label>
                                                                </li>
                                                                <li>
                                                                    <input type="checkbox" class="check"
                                                                           id="statusReject" name="statusReject"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusReject !=null}">
                                                                    <label>Bị từ chối</label>
                                                                </li>
                                                                <li>
                                                                    <input type="checkbox" class="check"
                                                                           id="statusActive" name="statusActive"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusActive !=null}">
                                                                    <label>Đang chạy</label>
                                                                </li>
                                                                <li>
                                                                    <input type="checkbox" class="check"
                                                                           id="statusPause" name="statusPause"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusPause !=null}">
                                                                    <label>Tạm dừng</label>
                                                                </li>
                                                                <li>
                                                                    <input type="checkbox" class="check"
                                                                           id="statusEnd" name="statusEnd"
                                                                           data-checkbox="icheckbox_square-purple"
                                                                           th:checked="${statusEnd !=null}">
                                                                    <label>Kết thúc</label>
                                                                </li>
                                                            </ul>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2 btn_search btn_search_cp">
                                                    <div class="btn-group">
                                                        <button type="submit" class="btn btn-rounded btn-primary"
                                                                onclick="searchCampaign();"><i
                                                                class="ti-search"></i> Tìm kiếm
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row form_qldhqc">
                                        <div class="col-sm-12 col-xs-12">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                    <tr>
                                                        <th style="text-align: center">STT</th>
                                                        <th style="text-align: center">Tên chiến dịch</th>
                                                        <th style="text-align: center">Loại chiến dịch</th>
                                                        <th style="text-align: center">Trạng thái</th>
                                                        <th style="text-align: center">Ngày bắt đầu</th>
                                                        <th style="text-align: center">Ngày kết thúc</th>
                                                        <th style="text-align: center">Người tạo</th>
                                                        <th style="text-align: center">Ngày tạo</th>
                                                        <th>Thao tác</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr th:if="${totalPages == 0}">
                                                        <td th:if="${totalPages == 0}" colspan="15" class="font-bold">
                                                            Không tìm thấy chiến dịch phù hợp
                                                        </td>
                                                    </tr>

                                                    <tr th:each="data,loop : ${campaignManagerDtos}">
                                                        <td style="text-align: left"
                                                            th:text="${loop.index+1+(currentPage-1)*pageSize}"></td>
                                                        <td>
                                                            <div class="scroll-inline" style="text-align: left"
                                                                 th:text="${data.getName()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline" style="text-align: left"
                                                                 th:if="${data.getType()} == 1">Sự kiện
                                                            </div>
                                                            <div class="scroll-inline" style="text-align: left"
                                                                 th:if="${data.getType()} == 2">Tần suất
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline badge badge-pill badge-success"
                                                                 style="text-align: left"
                                                                 th:if="${data.getStatus()} == 0">Đang chạy
                                                            </div>
                                                            <div class="scroll-inline badge badge-pill badge-primary"
                                                                 style="text-align: left"
                                                                 th:if="${data.getStatus()} == 1">Đang xử lý
                                                            </div>
                                                            <div class="scroll-inline badge badge-pill"
                                                                 style="text-align: left; background-color: blueviolet"
                                                                 th:if="${data.getStatus()} == 2">Chờ phê duyệt
                                                            </div>
                                                            <div class="scroll-inline" style="text-align: left"
                                                                 th:if="${data.getStatus()} == 3">Phê duyệt
                                                            </div>
                                                            <div class="scroll-inline badge badge-pill badge-default"
                                                                 style="text-align: left"
                                                                 th:if="${data.getStatus()} == 4">Kết thúc
                                                            </div>
                                                            <div class="scroll-inline badge badge-pill badge-danger"
                                                                 style="text-align: left"
                                                                 th:if="${data.getStatus()} == 5">Bị từ chối
                                                            </div>
                                                            <div class="scroll-inline badge badge-pill badge-warning"
                                                                 style="text-align: left"
                                                                 th:if="${data.getStatus()} == 6">Tạm dừng
                                                            </div>

                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline" style="text-align: center"
                                                                 th:text="${data.getStartDate()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline" style="text-align: center"
                                                                 th:if="${data.getEndDate() != null}"
                                                                 th:text="${data.getEndDate()}"></div>
                                                            <div class="scroll-inline" style="text-align: center"
                                                                 th:unless="${data.getEndDate() != null}">-
                                                            </div>
                                                        </td>

                                                        <td>
                                                            <div class="scroll-inline" style="text-align: left"
                                                                 th:text="${data.getUserName()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline" style="text-align: center"
                                                                 th:text="${data.getCreatedDate()}"></div>
                                                        </td>
                                                        <td class="act_ksn">
                                                            <div class="btn-group">
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        title="Xem chi tiết"
                                                                        th:onclick="viewDetail([[${data.getId()}]],[[${data.getType()}]])">
                                                                    <i class="eye_ic"></i>
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        title="Chỉnh sửa"
                                                                        th:if="${data.getStatus() != 4  && data.getStatus() != 0  && data.getStatus() != 2  && data.getStatus() != 3  && data.getStatus() != 6  && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || data.getUserName() == currentUser) && (roleLogin != 'Báo cáo')} "
                                                                        th:onclick="editCampaign([[${data.getId()}]],[[${data.getType()}]])">
                                                                    <i class="edit_ic"></i>
                                                                </button>
                                                                <a
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black viewPdf"
                                                                        title="Xuất chi tiết"
                                                                        th:attr="data-id=${data.getId()}, data-type=${data.getType()}"
                                                                        th:if="${roleLogin != 'Báo cáo'}">
                                                                    <i class="ti-share"></i>
                                                                </a>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        title="Phê duyệt"
                                                                        th:if="${data.getStatus() == 2 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin')} "
                                                                        th:onclick="approvalCampaign([[${data.getId()}]],2,[[${data.getType()}]],[[${data.getStartDate()}]],[[${data.getEndDate()}]])">
                                                                    <i class="ti-check"></i>
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        title="Từ chối phê duyệt"
                                                                        th:if="${data.getStatus() == 2 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin')} "
                                                                        th:onclick="refuseCampaign([[${data.getId()}]],2,[[${data.getType()}]])">
                                                                    <i class="ti-close"></i>
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black dropdown-toggle btn_more_act"
                                                                        th:if="${ (roleLogin == 'Quản trị' || roleLogin == 'Super Admin'|| roleLogin != 'Báo cáo' )} "
                                                                        data-toggle="dropdown" aria-haspopup="true"
                                                                        aria-expanded="false">
                                                                    <i class="ti-more"></i>
                                                                </button>

                                                                <div class="dropdown-menu">
                                                                    <button type="button" class="dropdown-item" href="#"
                                                                            title="Gửi phê duyệt"
                                                                            th:if="${data.getStatus() == 1 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || data.getUserName() == currentUser) && (roleLogin != 'Báo cáo') } "
                                                                            th:onclick="sendApprovalCampaign([[${data.getId()}]],1,2,[[${data.getType()}]],[[${data.getStartDate()}]],[[${data.getEndDate()}]])">
                                                                        <i class="ti-new-window"></i>&nbsp;&nbsp;Gửi
                                                                        phê
                                                                        duyệt
                                                                    </button>
                                                                    <button type="button" class="dropdown-item"
                                                                            title="Xem kết quả"
                                                                            th:if="${(data.getStatus() != 1  && data.getStatus() != 2  && data.getStatus() != 3  && data.getStatus() != 5) ||
                                                                            (data.getStatus() == 4 && (data.getStatusOld() != 1  || data.getStatusOld() != 2  || data.getStatusOld() != 3  || data.getStatusOld() != 5 ))} "
                                                                            th:onclick="changeReport([[${data.getName()}]] , [[${data.getStartDate()}]], [[${data.getEndDate()}]], [[${data.getStatus()}]],[[${data.getType()}]])">
                                                                        <i class="ti-stats-up"></i>&nbsp;&nbsp;Xem
                                                                        kết
                                                                        quả
                                                                    </button>
                                                                    <button type="button" class="dropdown-item" href="#"
                                                                            title="Sao chép"
                                                                            th:onclick="copyCampaign([[${data.getId()}]],[[${data.getType()}]])"
                                                                            th:if="${roleLogin != 'Báo cáo'}">
                                                                        <i class="ti-files"></i>&nbsp;&nbsp;Sao
                                                                        chép
                                                                    </button>
                                                                    <button type="button" class="dropdown-item"
                                                                            title="Kết thúc"
                                                                            th:if="${data.getStatus() != 4 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || data.getUserName() == currentUser) && (roleLogin != 'Báo cáo')}"
                                                                            href="#"
                                                                            th:onclick="endCampaign([[${data.getId()}]],1,4,[[${data.getType()}]])">
                                                                        <i class="ti-control-stop"></i>&nbsp;&nbsp;Kết
                                                                        thúc
                                                                    </button>
                                                                    <button type="button" class="dropdown-item"
                                                                            title="Tạm dừng"
                                                                            th:if="${data.getStatus() == 0 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || data.getUserName() == currentUser) && (roleLogin != 'Báo cáo')}"
                                                                            href="#"
                                                                            th:onclick="pauseCampaign([[${data.getId()}]],0,6,[[${data.getType()}]])">
                                                                        <i class="ti-control-pause"></i>&nbsp;&nbsp;Tạm
                                                                        dừng
                                                                    </button>
                                                                    <button type="button" class="dropdown-item"
                                                                            title="Tái khởi tạo"
                                                                            th:if="${data.getStatus() == 6 && (roleLogin == 'Quản trị' || roleLogin == 'Super Admin' || data.getUserName() == currentUser) && (roleLogin != 'Báo cáo')}"
                                                                            href="#"
                                                                            th:onclick="reInitializationCampaign([[${data.getId()}]],6,0,[[${data.getType()}]])">
                                                                        <i class="ti-control-play"></i>&nbsp;&nbsp;Tái
                                                                        khởi
                                                                        tạo
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    </tbody>
                                                </table>

                                                <div class="float-right m-t-20">
                                                    <nav aria-label="Page navigation">
                                                        <ul class="pagination-sm" id="pagination"></ul>
                                                    </nav>
                                                </div>

                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <!-- Row -->
            <!-- ============================================================== -->
            <!-- End PAge Content -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->

            <!-- End Right sidebar -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Container fluid  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->

        <!-- footer -->
        <!-- ============================================================== -->

        <!-- ============================================================== -->
        <!-- End footer -->
        <!-- ============================================================== -->

    </div>
    <!-- End Page wrapper  -->
    <div th:insert="common/footer" th:remove="tag"></div>
    <input type="hidden" id="common-csrf" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

</div>
</body>
<script th:inline="javascript">
    $(document).ready(function () {
        $("#createdDate").datepicker({dateFormat: 'dd/mm/yy'}).keypress(function (event) {
            event.preventDefault(); // prevent keyboard writing but allowing value deletion
        }).bind('paste', function (e) {
            e.preventDefault()
        });

        $("#startDate").datepicker({dateFormat: 'dd/mm/yy'}).keypress(function (event) {
            event.preventDefault(); // prevent keyboard writing but allowing value deletion
        }).bind('paste', function (e) {
            e.preventDefault()
        });

        $("#endDate").datepicker({dateFormat: 'dd/mm/yy'}).keypress(function (event) {
            event.preventDefault(); // prevent keyboard writing but allowing value deletion
        }).bind('paste', function (e) {
            e.preventDefault()
        });

        $('[data-toggle="tooltip"]').tooltip({
            trigger: 'hover'
        })


    })
    const today = new Date();
    $("#createdDate").datepicker({format: 'dd/mm/yyyy', todayHighlight: true});

    $("#startDate").datepicker({format: 'dd/mm/yyyy', todayHighlight: true});

    $("#endDate").datepicker({format: 'dd/mm/yyyy', todayHighlight: true});


    function searchCampaign() {
        $('#campaignMangerForm').attr('action', '/campaignManager');
    }

    function pauseCampaign(id, oldStatus, status, type) {
        swal({
            title: "CampaignX  Thông báo",
            text: "Bạn muốn tạm dừng chiến dịch?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "OK",
            cancelButtonText: "Hủy",
            closeOnConfirm: false
        }, function () {
            window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=' + status + '&type=' + type;
        });
    }

    function reInitializationCampaign(id, oldStatus, status, type) {
        swal({
            title: "CampaignX  Thông báo",
            text: "Bạn muốn tái khởi tạo chiến dịch?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "OK",
            cancelButtonText: "Hủy",
            closeOnConfirm: false
        }, function () {
            window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=' + status + '&type=' + type;
        });
    }

    function endCampaign(id, oldStatus, status, type) {
        swal({
            title: "CampaignX  Thông báo",
            text: "Bạn muốn kết thúc chiến dịch?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "OK",
            cancelButtonText: "Hủy",
            closeOnConfirm: false
        }, function () {
            window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=' + status + '&type=' + type;
        });
    }

    function sendApprovalCampaign(id, oldStatus, status, type, startDate, endDate) {
        var check = false;
        var date = new Date();
        var scheStart = startDate;
        scheStart = scheStart.replace(new RegExp("/", 'g'), " ");
        scheStart = scheStart.split(" ");
        var scheStartDate = new Date(scheStart[2], scheStart[1] - 1, scheStart[0], 23, 59, 59);
        console.log("scheStartDate:" + scheStartDate);
        console.log("date:", date);
        if (endDate == null) {
            if (date > scheStartDate) {
                check = true;
            }
        } else {
            var scheEnd = endDate;
            scheEnd = scheEnd.replace(new RegExp("/", 'g'), " ");
            scheEnd = scheEnd.split(" ");
            var scheEndDate = new Date(scheEnd[2], scheEnd[1] - 1, scheEnd[0], 23, 59, 59);
            if (date > scheEndDate) {
                check = true;
            }
        }
        if (check) {
            showErrorMessage("Hiệu lực của chiến dịch đã kết thúc. Vui lòng chỉnh sửa trước khi gửi phê duyệt.")
        } else {
            swal({
                title: "CampaignX  Thông báo",
                text: "Bạn muốn gửi yêu cầu phê duyệt chiến dịch?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "OK",
                cancelButtonText: "Hủy",
                closeOnConfirm: false
            }, function () {
                window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=' + status + '&type=' + type;
            });
        }


    }

    function approvalCampaign(id, oldStatus, type, startDate, endDate) {
        var check = false;
        var date = new Date();
        var scheStart = startDate;
        scheStart = scheStart.replace(new RegExp("/", 'g'), " ");
        scheStart = scheStart.split(" ");
        var scheStartDate = new Date(scheStart[2], scheStart[1] - 1, scheStart[0], 23, 59, 59);
        console.log("scheStartDate:" + scheStartDate);
        console.log("date:", date);
        if (endDate == null) {
            if (date > scheStartDate) {
                check = true;
            }
        } else {
            var scheEnd = endDate;
            scheEnd = scheEnd.replace(new RegExp("/", 'g'), " ");
            scheEnd = scheEnd.split(" ");
            var scheEndDate = new Date(scheEnd[2], scheEnd[1] - 1, scheEnd[0], 23, 59, 59);
            if (date > scheEndDate) {
                check = true;
            }
        }
        if (check) {
            showErrorMessage("Hiệu lực của chiến dịch đã kết thúc. Vui lòng từ chối phê duyệt để chỉnh sửa.")

        } else {
            swal({
                title: "CampaignX  Thông báo",
                text: "Bạn muốn phê duyệt chiến dịch?",
                type: "warning",
                showCancelButton: true,
                showCloseButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "OK",
                cancelButtonText: "Hủy",
                closeOnConfirm: true,
                closeOnCancel: true
            }, function () {
                window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=0' + '&type=' + type;
            });
        }
    }

    function refuseCampaign(id, oldStatus, type) {
        swal({
            title: "CampaignX  Thông báo",
            text: "Bạn muốn từ chối phê duyệt chiến dịch?",
            type: "warning",
            showCancelButton: true,
            showCloseButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "OK",
            cancelButtonText: "Hủy",
            closeOnConfirm: true,
            closeOnCancel: true
        }, function () {
            window.location.href = '/campaignManager/changeStatus?id=' + id + '&status=5' + '&type=' + type;
        });
        return false;
    }

    function changeReport(name, startDate, endDate,status,type) {
        var scheStart = startDate;
        scheStart = scheStart.replace(new RegExp("/", 'g'), " ");
        scheStart = scheStart.split(" ");

        var scheStartDate = new Date(scheStart[2], scheStart[1] - 1, scheStart[0]);
        console.log("scheStartDate:" + scheStartDate);

        if (endDate != null) {
            var scheEnd = endDate
            scheEnd = scheEnd.replace(new RegExp("/", 'g'), " ");
            scheEnd = scheEnd.split(" ");
            var scheEndDate = new Date(scheEnd[2], scheEnd[1] - 1, scheEnd[0]);
        }

        let d = new Date();
        let month = d.getMonth() + 1;
        if (scheStartDate > d) {
            if (month < 10) {
                startDate = d.getDate() + "/" + "0" + month + "/" + d.getFullYear();
            } else if (month >= 10) {
                startDate = d.getDate() + "/" + month + "/" + d.getFullYear();
            }
        }
        if (scheEndDate > d) {
            if (month < 10) {
                endDate = d.getDate() + "/" + "0" + month + "/" + d.getFullYear();
            } else if (month >= 10) {
                endDate = d.getDate() + "/" + month + "/" + d.getFullYear();
            }
        }
        if (endDate == null) {
            if (month < 10) {
                endDate = d.getDate() + "/" + "0" + month + "/" + d.getFullYear();
            } else if (month >= 10) {
                endDate = d.getDate() + "/" + month + "/" + d.getFullYear();
            }
        }
        window.location.href = '/ReportController/overview?type=' + type + '&status=' + status + '&campaignName=' + name + '&checkCampaign=1&startDate=' + startDate + '&endDate=' + endDate +'&chartType=1';
    }

    function exportCampaign() {
        let token = $("#common-csrf").val();
        let queryString = window.location.search;
        let d = new Date();
        let month = d.getMonth() + 1;
        if((d.getMonth() + 1) < 10) {
            month = '0'+(d.getMonth() + 1);
        }
        let day = d.getDate();
        if(d.getDate() < 10) {
            day = '0'+d.getDate();
        }
        let today = day + "" + month + d.getFullYear();
        let h = d.getHours();
        if(d.getHours() < 10) {
            h = '0'+d.getHours();
        }
        let m = d.getMinutes();
        if(d.getMinutes() < 10) {
            m = '0'+d.getMinutes();
        }
        let s = d.getSeconds();
        if(d.getSeconds() < 10) {
            s = '0'+d.getSeconds();
        }
        let time = h+ "" + m + s;
        let fileName = "Danh_sach_chien_dich" + "_" + today + "_" + time + ".xlsx";
        fetch(contextPath + 'campaignManager/exportCampaign' + queryString)
            .then(resp => resp.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                // the filename you want
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(err => console.log(err));
        // $('#targetGroupForm').attr('action', '/TagetGroupManagerController/exportTargetGroup');
    }

    function viewDetail(id, type) {
        window.location.href = '/campaignManager/detail-frequency-campaign/' + id + '?type=' + type;
    }

    function editCampaign(id, type) {
        if (type == 2) {
            window.location.href = '/frequency-campaign/edit?frequencyCampaignId=' + id;
        } else if (type == 1) {
            window.location.href = '/event-campaign/edit?eventCampaignId=' + id;
        }
    }

    function copyCampaign(id, type) {
        if (type == 2) {
            window.location.href = '/frequency-campaign/copy?frequencyCampaignId=' + id;
        } else if (type == 1) {
            window.location.href = '/event-campaign/copy?eventCampaignId=' + id;
        }
    }

    $(document).ready(function () {
        $(".viewPdf").on("click", function () {
            var id = $(this).attr("data-id");
            var type = $(this).attr("data-type");
            var linkPdf = '/campaignManager/exportpdf/' + id + '?type=' + type;
            $(this).attr("href", linkPdf);
            $(this).attr("target", "_blank");
        })
    })

    function showErrorMessage(message) {
        Swal.fire({
            position: 'top',
            type: 'info',
            title: 'CampaignX Thông báo',
            text: message,
            showConfirmButton: false,
            timer: 5000
        })
    }
</script>
</html>