<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/html">
<head th:replace="common/head :: head"></head>
<style>
    .modal-table td {
        vertical-align: middle !important;
        border: none !important;;
    }

    .btn {
        padding: 8px 12px !important;
        font-size: 16px !important;
    }

    .modal-content {
        min-width: 670px;
    }

    .modal-body p {
        word-wrap: break-word;
    }

    .custom-select {
        background-color: #fff;
    }

    .card-title .fa-send {
        display: block;
        width: 24px;
        height: 24px;
        transform: translateY(3px);
    }

</style>
<body class="fix-header card-no-border">
<div th:insert="common/templates::alertMessage"></div>
<div th:insert="common/templates::pagination"></div>
<div th:insert="common/templates::contextPath"></div>
<div class="preloader">
    <svg class="circular" viewBox="25 25 50 50">
        <circle class="path" cx="50" cy="50" fill="none" r="20" stroke-miterlimit="10" stroke-width="2"/>
    </svg>
</div>

<div id="main-wrapper">
    <div th:replace="common/bodyHeader"></div>

    <div th:replace="common/leftmenu"></div>

    <div class="page-wrapper">
        <div class="container-fluid">
            <div class="row pd-r-ctn">
                <div class="col-12">
                    <!--Data table -->
                    <form id="sendingAccountForm" class="form" method="get">
                        <div class="card">

                            <div class="card-block">
                                <div class="row smal_title">
                                    <h4 class="card-title col-lg-6 d-flex"><i class="fa fa-send"></i>Danh sách tài khoản gửi tin</h4>
                                    <div class="title_btn col-1g-6">
                                        <div class="btn-group">
                                            <button type="button" onclick="handleShowModalAddSendingAccount()"
                                                    class="btn btn-rounded btn-primary"><i class="ti-plus text"
                                                                                           aria-hidden="true"></i>Thêm
                                                tài khoản
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="table-responsive m-t-10">

                                    <div class="row search_table">
                                        <div class="col-md-10">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Tên tài khoản gửi tin</label>
                                                        <input type="text" id="senderAccount" name="senderAccount"
                                                               maxlength="100" th:value="${senderAccount}"
                                                               class="form-control"
                                                               placeholder="Tìm kiếm tên tài khoản gửi tin">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <div class="form-group">
                                                            <label class="control-label">Kênh truyền thông</label>
                                                            <select class="custom-select col-9 form-control"
                                                                    name="mediaChannel">
                                                                <option value="" th:selected="${mediaChannel} == null">
                                                                    Tất cả
                                                                </option>
                                                                <option value="1" th:selected="${mediaChannel} == 1">
                                                                    SMS
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Trạng thái</label>
                                                        <select class="custom-select col-9 form-control" name="status">
                                                            <option value="" th:selected="${status} == null">Tất cả
                                                            </option>
                                                            <option value="0" th:selected="${status} == 0">Hoạt động
                                                            </option>
                                                            <option value="1" th:selected="${status} == 1">Tạm dừng
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 btn_search">
                                            <div class="btn-group">
                                                <button type="submit" class="btn btn-rounded btn-primary"
                                                        onclick="searchSendingAccount()"><i class="ti-search"></i> Tìm
                                                    kiếm
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row form_qldhqc">
                                        <div class="col-sm-12 col-xs-12">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                    <tr>
                                                        <th style="text-align: center">#</th>
                                                        <th style="text-align: center">Tài khoản gửi tin</th>
                                                        <th style="text-align: center">Kênh truyền thông</th>
                                                        <th style="text-align: center">Người tạo</th>
                                                        <th style="text-align: center">Ngày tạo</th>
                                                        <th style="text-align: center">Trạng thái</th>
                                                        <th style="text-align: center">Thao tác</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr th:if="${totalPages == 0}">
                                                        <td th:if="${totalPages == 0}" colspan="15"
                                                            class="font-bold text-center">Không tìm thấy tài khoản gửi
                                                            tin phù hợp
                                                        </td>
                                                    </tr>
                                                    <tr th:each="data,loop : ${sendingAccounts}">
                                                        <td class="text-left"
                                                            th:text="${loop.index+1+(currentPage-1)*pageSize}"></td>
                                                        <td>
                                                            <div class="scroll-inline text-left"
                                                                 th:text="${data.getSenderAccount()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline text-left"
                                                                 th:text="${data.getMediaChannel()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline text-left"
                                                                 th:text="${data.getCreatedBy()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline text-center"
                                                                 th:text="${data.getCreatedDate()}"></div>
                                                        </td>
                                                        <td>
                                                            <div class="scroll-inline text-left"
                                                                 th:text="${data.getStatus()}"></div>
                                                        </td>
                                                        <td class="act_ksn">
                                                            <div class="btn-group">
                                                                <button type="button" class="btn btn_ksn btn_ksn_delete"
                                                                        data-toggle="tooltip" data-placement="top"
                                                                        title="Xem chi tiết"
                                                                        th:onclick="handleShowModalDetailSendingAccount([[${data.getId()}]])">
                                                                    <i class="eye_ic"></i>
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        data-toggle="tooltip" data-placement="top"
                                                                        title="Chỉnh sửa"
                                                                        th:onclick="handleShowModalEditSendingAccount([[${data.getId()}]])">
                                                                    <i class="edit_ic"></i>
                                                                </button>
                                                                <button type="button"
                                                                        class="btn btn_ksn btn_ksn_delete btn_cl_black"
                                                                        data-toggle="tooltip" data-placement="top"
                                                                        title="Xóa"
                                                                        th:onclick="handleDeleteSendingAccount([[${data.getId()}]])">
                                                                    <i class="trash_ic"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>

                                                <div class="float-right m-t-20">
                                                    <nav aria-label="Page navigation">
                                                        <ul class="pagination-sm" id="pagination"></ul>
                                                    </nav>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>

            </div>
            <!-- Row -->
            <!-- ============================================================== -->
            <!-- End PAge Content -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->

            <!-- End Right sidebar -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Container fluid  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->

        <!-- footer -->
        <!-- ============================================================== -->

        <!-- ============================================================== -->
        <!-- End footer -->
        <!-- ============================================================== -->

    </div>
    <!-- End Page wrapper  -->
    <div th:insert="common/footer" th:remove="tag"></div>
    <input type="hidden" id="csrfToken" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <!-- Add Sending Account -->
    <div id="modalAddSendingAccount" data-backdrop="static" data-keyboard="false" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info-header shadow-sm">
                    <h3 class="modal-title text-themecolor rounded">Thêm mới tài khoản gửi tin</h3>
                </div>
                <form id="AddSendingAccountForm" method="post" onkeydown="return event.key != 'Enter';">
                    <div class="modal-body">
                        <table class="table table-hover modal-table">
                            <tbody>
                            <tr>
                                <td>Kênh truyền thông: <span class="text-danger">(*)</span></td>
                                <td>
                                    <select class="form-control custom-select mb-0" name="addMediaChannel" tabindex="1"
                                            id="addMediaChannel">
                                        <option value="" hidden="hidden" title="Chọn kênh truyền thông" selected>Chọn
                                            kênh truyền thông
                                        </option>
                                        <option value="1">SMS</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Tài khoản gửi tin: <span class="text-danger">(*)</span></td>
                                <td>
                                    <div class="form-group mb-0">
                                        <input class="form-control" type="text" tabindex="2" name="addSenderAccount"
                                               id="addSenderAccount" placeholder="Nhập tên tài khoản gửi tin"
                                               maxlength="11"/>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Trạng thái: <span class="text-danger">(*)</span></td>
                                <td>
                                    <select class="form-control custom-select mb-0" name="addStatus" tabindex="3"
                                            id="addStatus">
                                        <option value="2" hidden="hidden" title="Chọn trạng thái" selected>Chọn trạng
                                            thái
                                        </option>
                                        <option value="0">Hoạt động</option>
                                        <option value="1">Tạm dừng</option>
                                    </select>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-rounded btn-danger" onclick="closeModel('modalAddSendingAccount','Bạn muốn hủy thêm mới tài khoản gửi tin?')">Hủy</button>
                    <button type="button" onclick="handleAddSendingAccount(event)" class="btn btn-primary">Lưu</button>
                </div>
                <input type="hidden" id="is-valid-info-add" value="0">
            </div>
        </div>
    </div>

    <!-- Edit Sending Account -->

    <div id="modalEditSendingAccount" data-backdrop="static" data-keyboard="false" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info-header shadow-sm">
                    <h3 class="modal-title text-themecolor rounded">Chỉnh sửa tài khoản gửi tin</h3>
                </div>
                <form id="editSendingAccountForm" method="post" onkeydown="return event.key != 'Enter';">
                    <div class="modal-body">
                        <table class="table table-hover modal-table">
                            <tbody>
                            <input type="hidden" id="editId"/>
                            <tr>
                                <td>Kênh truyền thông: <span class="text-danger">(*)</span></td>
                                <td>
                                    <select class="form-control custom-select mb-0" name="editMediaChannel" tabindex="1"
                                            id="editMediaChannel">
                                        <option value="" hidden="hidden" title="Chọn kênh truyền thông"
                                                selected></option>
                                        <option value="1">SMS</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Tài khoản gửi tin: <span class="text-danger">(*)</span></td>
                                <td>
                                    <div class="form-group mb-0">
                                        <input class="form-control" type="text" tabindex="2" name="editSenderAccount"
                                               id="editSenderAccount" placeholder="Nhập tên tài khoản gửi tin"
                                               maxlength="11"/>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Trạng thái: <span class="text-danger">(*)</span></td>
                                <td>
                                    <select class="form-control custom-select mb-0" name="editStatus" tabindex="3"
                                            id="editStatus">
                                        <option value="" hidden="hidden" title="Chọn trạng thái" selected></option>
                                        <option value="0">Hoạt động</option>
                                        <option value="1">Tạm dừng</option>
                                    </select>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="btn_main_act btn_R">
                            <div class="btn-group">
                                <button type="button" class="btn btn-rounded btn-primary"
                                        onclick="handleUpdateSendingAccount(event)">Lưu
                                </button>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-rounded btn-danger" onclick="closeModel('modalEditSendingAccount','Bạn muốn hủy chỉnh sửa tài khoản gửi tin?')">Hủy
                                </button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="is-valid-info-update" value="0">
                </form>

            </div>
        </div>
    </div>

    <!-- Detail Sending Account -->
    <div id="modalDetailSendingAccount" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info-header shadow-sm">
                    <h3 class="modal-title text-themecolor rounded">Chi tiết Tài khoản gửi tin</h3>
                </div>
                <form>
                    <div class="modal-body">
                        <div class="row">
                            <input type="hidden" id="detailId"/>
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Gói dịch vụ:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailMediaChannel"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Người tạo:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailCreatedBy"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Tài khoản gửi tin:</div>
                                    <div class="col-6">
                                        <p id="detailSenderAccount"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Ngày tạo:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailCreatedDate"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Trạng thái:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailStatus"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Người cập nhật:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailModifiedBy"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="row">

                                </div>
                            </div>
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-6">Cập nhật lần cuối:</div>
                                    <div class="col-6 text-wrap">
                                        <p id="detailLastModifiedDate"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-rounded btn-danger" data-dismiss="modal">Hủy</button>
                    <button type="button" onclick="handleRedirectUpdateSendingAccount()" class="btn btn-primary">Sửa
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Detail Sending Account -->

</div>
</body>

<script th:inline="javascript">
    var token = $("#csrfToken").val();

    // $(document).ready(function () {
    //     $('#modalEditSendingAccount').on('hide.bs.modal', function (event) {
    //         let isValidData = $("#is-valid-info-update").val();
    //         if (isValidData == 0) {
    //             if (!confirm("Bạn muốn hủy chỉnh sửa tài khoản gửi tin?")) {
    //                 event.preventDefault();
    //             }
    //         }
    //     });
    //     $('#modalAddSendingAccount').on('hide.bs.modal', function (event) {
    //         let isValidData = $("#is-valid-info-add").val();
    //         if (isValidData == 0) {
    //             if (!confirm("Bạn muốn hủy thêm mới tài khoản gửi tin?")) {
    //                 event.preventDefault();
    //                 event.stopPropagation();
    //             }
    //         }
    //     });
    //
    // });

    function closeModel(id, message) {
        Swal.fire({
            position: 'top',
            title: 'Thông báo',
            text: message,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'OK',
            cancelButtonText: 'HỦY'
        }).then((result) => {
            if (result.value) {
                $('#modalAddSendingAccount').modal('hide');
                $('#modalEditSendingAccount').modal('hide');
            }
        });
    }

    function searchSendingAccount() {
        $('#sendingAccountForm').attr('action', '/sending-accounts/manager');
    }

    function handleShowModalAddSendingAccount() {
        $('#modalAddSendingAccount').find('form').trigger('reset');
        $('#modalAddSendingAccount').modal('show');
        removeTooltip("addMediaChannel");
        removeTooltip("addSenderAccount");
        removeTooltip("addStatus");
    }

    function handleAddSendingAccount(event) {
        $("#is-valid-info-add").val(1);
        event.preventDefault();
        const isValid = validateAddSendingAccount();
        const mediaChannel = $("#addMediaChannel").val().trim();
        const senderAccount = $("#addSenderAccount").val().trim();
        const status = $("#addStatus").val().trim();

        if (isValid) {

            const data = JSON.stringify({
                "mediaChannel": mediaChannel,
                "senderAccount": senderAccount,
                "status": status,
            });

            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                url: '/sending-accounts',
                traditional: true,
                dataType: "JSON",
                headers: {
                    'X-CSRF-Token': token
                },
                data: data,
                cache: true,
                async: false,
                success: function (response) {
                    const httpStatus = response.code;
                    const message = response.message;
                    switch (httpStatus) {
                        case 200:
                            // $('#modalAddSendingAccount').modal('hide');
                            showAlertMessageSuccess(message);
                            setTimeout(function () {
                                window.location.href = '/sending-accounts/manager';
                            }, 1500);
                            break;
                        case 400:
                            // showAlertMessageError(response.message);
                            showTooltip(message, "addSenderAccount")
                            break;
                    }
                },
                error: function (e) {
                    console.log(e);
                },
            })
        }

    }

    function countSenderAccount(name) {
        let flag = true
        $.ajax({
            url: '/sending-accounts/containSenderAccount?name=' + name,
            type: 'get',
            dataType: 'json',
            async: false,
            success: function (response) {
                flag = response.result;
            }
        });
        return flag;
    }

    function containSenderAccountIsNotId(name, id) {
        let flag = true
        $.ajax({
            url: '/sending-accounts/containSenderAccountIsNotId/' + id + '?name=' + name,
            type: 'get',
            dataType: 'json',
            async: false,
            success: function (response) {
                flag = response.result;
            }
        });
        return flag;
    }

    function isSenderAccountName(name) {
        let flag = true
        $.ajax({
            url: '/sending-accounts/validateSenderAccount?name=' + name,
            type: 'get',
            dataType: 'json',
            async: false,
            success: function (response) {
                flag = response.result;
            }
        });
        return flag;
    }

    function validateName (senderAccount){
        var nameRegex =  /[^A-Za-z0-9]+/;
        var result = nameRegex.test(senderAccount);
        return result;
    }

    function validateAddSendingAccount() {
        const mediaChannel = $('#addMediaChannel').val().trim();
        const senderAccount = $('#addSenderAccount').val().trim();
        const status = $('#addStatus').val();
        let check = true;
        if (mediaChannel.length == 0) {
            // showAlertMessageError('Kênh truyền thông không được để trống. Vui lòng thử lại.');
            showTooltip("Vui lòng chọn kênh truyền thông.", "addMediaChannel");
            check = false;
        }

        if (senderAccount.length == 0) {
            // showAlertMessageError('Tài khoản gửi tin không được để trống. Vui lòng thử lại.');
            showTooltip("Tài khoản gửi tin không được để trống.", "addSenderAccount")
            check = false;
        }
        if(validateName(senderAccount)) {
                showTooltip("Chỉ nhập ký tự chữ và số, không nhập khoảng trắng và các ký tự đặc biệt.", "addSenderAccount")
                check = false;
        } else {
            if (countSenderAccount(senderAccount)) {
                showTooltip("Tài khoản gửi tin đã tồn tại.", "addSenderAccount")
                check = false;
            }
        }

        if (status == 2) {
            showTooltip("Vui lòng chọn trạng thái", "addStatus")
            check = false;
        }
        $("#is-valid-info-add").val(0);
        return check;
    }

    function handleShowModalEditSendingAccount(id) {
        handleGetSendingAccountDetail(id);
        $('#modalEditSendingAccount').modal('show');
        removeTooltip("editMediaChannel");
        removeTooltip("editSenderAccount");
        removeTooltip("editStatus");
    }

    function handleUpdateSendingAccount(event) {
        $("#is-valid-info-update").val(1);
        let abc = $("#is-valid-info-update").val();
        event.preventDefault();
        const isValid = validateUpdateSendingAccount();
        const id = $("#editId").val().trim();
        const mediaChannel = $("#editMediaChannel").val().trim();
        const senderAccount = $("#editSenderAccount").val().trim();
        const status = $("#editStatus").val().trim();

        if (isValid) {
            const data = JSON.stringify({
                "mediaChannel": mediaChannel,
                "senderAccount": senderAccount,
                "status": status,
            });

            $.ajax({
                type: 'PUT',
                contentType: 'application/json',
                url: `/sending-accounts/${id}`,
                traditional: true,
                dataType: "JSON",
                headers: {
                    'X-CSRF-Token': token
                },
                data: data,
                cache: true,
                async: false,
                success: function (response) {
                    const httpStatus = response.code;
                    const message = response.message;
                    if (httpStatus == 200) {
                       // $('#modalEditSendingAccount').modal('hide');
                        showAlertMessageSuccess(message);
                        setTimeout(function () {
                            window.location.href = '/sending-accounts/manager';
                        }, 1500);
                    }
                    if (httpStatus == 400 || httpStatus == 500) {
                        // showAlertMessageError(response.message);
                        showTooltip(message, "editSenderAccount")
                    }
                },
                error: function (e) {
                    console.log(e);
                },
            })
        }
    }

    function validateUpdateSendingAccount() {
        const mediaChannel = $('#editMediaChannel').val().trim();
        const senderAccount = $('#editSenderAccount').val().trim();
        const status = $('#editStatus').val().trim();
        const id = $("#editId").val().trim();

        let check = true;
        if (mediaChannel.length == 0) {
            // showAlertMessageError('Kênh truyền thông không được để trống. Vui lòng thử lại.');
            showTooltip("Vui lòng chọn kênh truyền thông.", "editMediaChannel");
            check = false;
        }

        if (senderAccount.length == 0) {
            // showAlertMessageError('Tài khoản gửi tin không được để trống. Vui lòng thử lại.');
            showTooltip("Tài khoản gửi tin không được để trống.", "editSenderAccount")
            check = false;
        }
        if(validateName(senderAccount)) {
            showTooltip("Chỉ nhập ký tự chữ và số, không nhập khoảng trắng và các ký tự đặc biệt.", "editSenderAccount")
            check = false;
        } else {
            if (containSenderAccountIsNotId(senderAccount, id)) {
                showTooltip("Tài khoản gửi tin đã tồn tại.", "editSenderAccount")
                check = false;
            }
        }


        if (status.length == 0) {
            // showAlertMessageError('Trạng thái không được để trống. Vui lòng thử lại.');
            showTooltip("Vui lòng chọn trạng thái", "editStatus")
            check = false;
        }

        return check;
    }

    function handleShowModalDetailSendingAccount(id) {
        $('#modalDetailSendingAccount').modal('show');
        handleGetSendingAccountDetail(id);
    }

    function handleGetSendingAccountDetail(id) {

        $.ajax({
            type: 'GET',
            contentType: 'application/json',
            url: `/sending-accounts/${id}`,
            traditional: true,
            dataType: "JSON",
            headers: {
                'X-CSRF-Token': token
            },
            cache: true,
            async: false,
            success: function (response) {
                if (response.code == 200) {
                    console.log("data", response.data);
                    const data = response.data;
                    $("#editMediaChannel").val(data.mediaChannelNumber);
                    $("#editSenderAccount").val(data.senderAccount);
                    $("#editStatus").val(data.statusNumber);
                    $("#editId").val(data.id);

                    $("#detailId").val(data.id);
                    $("#detailMediaChannel").text(data.mediaChannel);
                    $("#detailSenderAccount").text(data.senderAccount);
                    $("#detailStatus").text(data.status);
                    $("#detailCreatedDate").text(data.createdDate);
                    if(data.lastModifiedDate == null) {
                        $("#detailLastModifiedDate").text("-");

                    } else {
                        $("#detailLastModifiedDate").text(data.lastModifiedDate);
                    }
                    $("#detailCreatedBy").text(data.createdBy);
                    if(data.modifiedBy == null) {
                        $("#detailModifiedBy").text("-");

                    } else {
                        $("#detailModifiedBy").text(data.modifiedBy);

                    }
                }
            },
            error: function (e) {
                console.log(e);
            },
        })
    }

    function handleRedirectUpdateSendingAccount() {
        const id = $("#detailId").val();
        $('#modalDetailSendingAccount').modal('hide');
        handleGetSendingAccountDetail(id);
        $('#modalEditSendingAccount').modal('show');
    }

    function handleDeleteSendingAccount(id) {
        Swal.fire({
            title: "Bạn muốn xóa tài khoản gửi tin?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "Hủy",
            confirmButtonText: "OK",
            allowOutsideClick: true,
            reverseButtons: true
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    type: 'DELETE',
                    url: `/sending-accounts/${id}`,
                    traditional: true,
                    dataType: 'JSON',
                    headers: {
                        'X-CSRF-Token': token
                    },
                    cache: true,
                    async: false,
                    success: function (response) {
                        const httpStatus = response.code;
                        const message = response.message;
                        if (httpStatus == 200) {
                            showAlertMessageSuccess(response.message);
                            setTimeout(function () {
                                window.location.href = '/sending-accounts/manager';
                            }, 1500);
                        }
                        if (httpStatus == 500) {
                            showAlertMessageError(response.message);
                        }
                    },
                    error: function (e) {
                        console.log(e);
                    },
                })
            }
        })
    }

</script>

<script th:src="@{/js/common/common.js}"></script>
</html>